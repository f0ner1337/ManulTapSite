<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"> <!-- Предотвращение масштабирования -->
    <title>Кликер Манул</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="container">
        <div id="counter">0</div>
        <img src="img/manul.jpg" alt="Манул" id="manul">
        <div id="energy-container">
            <div id="energy-bar">5000⚡</div>
        </div>
        <div id="upgrade-container">
            <div id="upgrade-info">Уровень прокачки: <span id="upgrade-level">1</span></div>
            <button id="upgrade-button">Прокачать силу клика</button>
        </div>
    </div>
    <script>
        const manul = document.getElementById('manul');
        const counter = document.getElementById('counter');
        const energyBar = document.getElementById('energy-bar');
        const upgradeButton = document.getElementById('upgrade-button');
        const upgradeLevelSpan = document.getElementById('upgrade-level');

        let energy = parseFloat(localStorage.getItem('energy')) || 5000; // Начальная энергия
        let clicks = parseInt(localStorage.getItem('clicks')) || 0; // Начальное количество кликов
        let upgradeLevel = parseInt(localStorage.getItem('upgradeLevel')) || 1; // Начальный уровень прокачки

        // Обновление энергии и прогресс-бара
        function updateEnergy() {
            const lastUpdateTime = parseFloat(localStorage.getItem('lastUpdateTime')) || Date.now();
            const now = Date.now();
            const secondsElapsed = (now - lastUpdateTime) / 1000;

            if (energy < 5000) {
                energy += 0.5 * secondsElapsed; // Восстановление энергии
                if (energy > 5000) {
                    energy = 5000; // Ограничение максимальной энергии
                }
                localStorage.setItem('energy', energy);
                energyBar.textContent = `${Math.floor(energy)}⚡`;
                energyBar.style.width = `${energy / 5000 * 100}%`;
            }

            localStorage.setItem('lastUpdateTime', now); // Обновляем время последнего обновления
        }

        // Обработка клика
        manul.addEventListener('click', (event) => {
            if (energy > 0) {
                let clickValue = upgradeLevel; // Количество манулов за клик
                energy -= clickValue; // Расход энергии
                clicks += clickValue;
                localStorage.setItem('clicks', clicks);
                localStorage.setItem('energy', energy);
                counter.textContent = clicks;
                energyBar.textContent = `${Math.floor(energy)}⚡`;
                energyBar.style.width = `${energy / 5000 * 100}%`;

                // Создание элемента +X при клике
                const plusOne = document.createElement('div');
                plusOne.textContent = `+${clickValue}`;
                plusOne.className = 'plus-one';
                plusOne.style.left = `${event.clientX - container.offsetLeft}px`;
                plusOne.style.top = `${event.clientY - container.offsetTop}px`;
                container.appendChild(plusOne);

                // Удаление элемента +X после анимации
                setTimeout(() => {
                    container.removeChild(plusOne);
                }, 1000);

                // Анимация увеличения изображения манула
                manul.classList.add('clicked');
                setTimeout(() => {
                    manul.classList.remove('clicked');
                }, 100);
            }
        });

        // Обновление уровня прокачки
        upgradeButton.addEventListener('click', () => {
            if (clicks >= 100 * upgradeLevel) {
                clicks -= 100 * upgradeLevel;
                upgradeLevel++;
                localStorage.setItem('clicks', clicks);
                localStorage.setItem('upgradeLevel', upgradeLevel);
                upgradeLevelSpan.textContent = upgradeLevel;
                counter.textContent = clicks;
                energy = Math.max(0, energy - (upgradeLevel - 1)); // Расход энергии при прокачке
                localStorage.setItem('energy', energy);
                energyBar.textContent = `${Math.floor(energy)}⚡`;
                energyBar.style.width = `${energy / 5000 * 100}%`;
            }
        });

        // Восстанавливаем энергию каждую секунду
        setInterval(updateEnergy, 1000);

        // Устанавливаем начальное значение прокачки
        upgradeLevelSpan.textContent = upgradeLevel;
        energyBar.textContent = `${Math.floor(energy)}⚡`;
        energyBar.style.width = `${energy / 5000 * 100}%`;
        counter.textContent = clicks;
    </script>
</body>
</html>
